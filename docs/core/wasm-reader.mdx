---
title: 'Node.js (WASM)'
description: 'API Reference for the @zaim-abbasi/zon-wasm bridge.'
---

The `@zaim-abbasi/zon-wasm` package brings Rust-level performance to Node.js environments.

## Installation

```bash
npm install @zaim-abbasi/zon-wasm
```

## Serialization

<ParamField body="serialize(data: Object) -> Uint8Array" type="fn">
  Converts a JavaScript object directly into a ZON binary buffer.
  
  **Supported Types:**
  - Strings
  - Numbers (Integer)
  - *Nested Objects (Coming Soon)*
  
  ```javascript
  const { serialize } = require('@zon-lib/zon');
  
  const buffer = serialize({ name: "Alice", score: 100 });
  ```
</ParamField>

## Deserialization (Reader)

The `ZonReader` class wraps the binary buffer.

### Constructor

<ParamField body="new ZonReader(buffer: Uint8Array)" type="constructor">
  Initializes the reader. Throws if the magic header is invalid.
  
  ```javascript
  const reader = new ZonReader(buffer);
  ```
</ParamField>

### Methods

<ParamField body="rootOffset" type="getter property">
  Returns the offset to the root data item defined in the file header.
  
  ```javascript
  const root = reader.rootOffset;
  ```
</ParamField>

<ParamField body="readString(offset: number) -> string" type="method">
  Reads a UTF-8 string from the given offset.
  
  ```javascript
  const name = reader.readString(offset);
  ```
</ParamField>

<ParamField body="readU32(offset: number) -> number" type="method">
  Reads an unsigned 32-bit integer from the given offset.
  
  ```javascript
  const age = reader.readU32(offset);
  ```
</ParamField>

<ParamField body="len() -> number" type="method">
  Returns the total length of the buffer.
</ParamField>

## Writing Data (Writer)

For advanced usage, use `ZonWriter` to build a buffer manually.

### Constructor

<ParamField body="new ZonWriter()" type="constructor">
  Initializes a new empty writer.
</ParamField>

### Methods

<ParamField body="writeString(val: string) -> number" type="method">
  Writes a string and returns its offset.
</ParamField>

<ParamField body="writeU32(val: number) -> number" type="method">
  Writes a 32-bit integer and returns its offset.
</ParamField>

<ParamField body="setRoot(offset: number)" type="method">
  Sets the root offset for the file.
</ParamField>

<ParamField body="toBytes() -> Uint8Array" type="method">
  Returns the final binary buffer.
</ParamField>

## Memory Management

### Zero-Copy in JS?

When you pass a `Buffer` or `Uint8Array` to `ZonReader`, the WASM memory view is created over that buffer.

**Warning:** If you modify the underlying buffer while the reader is active, you may read corrupt data.


## Error Handling

The reader methods throws standard JavaScript `Error` objects if the access is invalid. You should wrap read operations in `try/catch` blocks if dealing with untrusted input.

```javascript
try {
  const val = reader.readU32(999999); // Out of bounds
} catch (e) {
  console.error(e.message); 
  // Output: "Read out of bounds" or "Invalid UTF-8"
}
```

**Common Errors:**
- `Buffer too small for ZonHeader`: The provided buffer is < 50 bytes.
- `Invalid Magic Number`: The file does not start with `ZON1`.
- `Read out of bounds`: Attempted to read past the end of the buffer.
